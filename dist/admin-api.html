<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VoteHub ‚Äî Admin Panel (API)</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(124,58,237,0.1));
      border: 1px solid rgba(59,130,246,0.2);
      border-radius: 1rem;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(59,130,246,0.2);
    }
    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #3b82f6, #7c3aed);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .stat-label {
      color: #9aa4b2;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    .search-box {
      position: relative;
      margin-bottom: 1.5rem;
    }
    .search-box input {
      padding-left: 3rem;
    }
    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #9aa4b2;
    }
    .action-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }
    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      border-radius: 0.6rem;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }
    .btn-edit {
      background: linear-gradient(90deg, #06b6d4, #3b82f6);
      color: white;
    }
    .btn-edit:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(6,182,212,0.3);
    }
    .btn-delete {
      background: linear-gradient(90deg, #ef4444, #dc2626);
      color: white;
    }
    .btn-delete:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(239,68,68,0.3);
    }
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background: var(--bg-800);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      animation: slideUp 0.3s ease;
    }
    .modal-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      justify-content: flex-end;
    }
    .w-full {
      width: 100%;
    }
    .ml-4 {
      margin-left: 1rem;
    }
    .mt-6 {
      margin-top: 1.5rem;
    }
    .space-y-4 > * + * {
      margin-top: 1rem;
    }
    .gap-4 {
      gap: 1rem;
    }
    .candidate-party {
      color: #9aa4b2;
      font-size: 0.9rem;
    }
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .header-actions {
      display: flex;
      gap: 0.75rem;
    }
    .candidate-card-enhanced {
      position: relative;
      overflow: hidden;
    }
    .candidate-card-enhanced::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3b82f6, #7c3aed, #ec4899);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .candidate-card-enhanced:hover::before {
      opacity: 1;
    }
  </style>
  <link rel="stylesheet" crossorigin href="/assets/stl-D4jZR053.css">
</head>
<body class="bg-900">
  <main class="site-main">
    <div class="auth-card max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold mb-4 text-center bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent animate-gradient-flow bg-300%">
        üîê Admin Control Panel
      </h2>
      
      <div id="loginSection" class="mb-6">
        <div style="text-align: center; margin-bottom: 2rem;">
          <div style="width: 80px; height: 80px; margin: 0 auto 1rem; background: linear-gradient(135deg, #3b82f6, #7c3aed); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 30px rgba(59,130,246,0.3);">
            <i data-lucide="shield" style="width: 40px; height: 40px; color: white;"></i>
          </div>
          <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Admin Authentication</h3>
          <p style="color: #9aa4b2;">Enter your credentials to access the control panel</p>
        </div>
        <form id="adminLoginForm" class="space-y-4">
          <input class="form-input" type="text" id="adminUsername" placeholder="üë§ Username" required />
          <input class="form-input" type="password" id="adminPassword" placeholder="üîí Password" required />
          <button class="btn-primary w-full" type="submit">
            <i data-lucide="log-in" style="width: 18px; height: 18px;"></i>
            Login as Admin
          </button>
        </form>
      </div>

      <div id="adminSection" style="display:none;">
        <!-- Statistics Dashboard -->
        <div class="stats-grid">
          <div class="stat-card">
            <i data-lucide="users" style="width: 32px; height: 32px; color: #3b82f6; margin: 0 auto 0.5rem;"></i>
            <div class="stat-value" id="totalCandidates">0</div>
            <div class="stat-label">Total Candidates</div>
          </div>
          <div class="stat-card">
            <i data-lucide="check-circle" style="width: 32px; height: 32px; color: #10b981; margin: 0 auto 0.5rem;"></i>
            <div class="stat-value" id="totalVotes">0</div>
            <div class="stat-label">Total Votes</div>
          </div>
          <div class="stat-card">
            <i data-lucide="trending-up" style="width: 32px; height: 32px; color: #ec4899; margin: 0 auto 0.5rem;"></i>
            <div class="stat-value" id="activeUsers">0</div>
            <div class="stat-label">Active Users</div>
          </div>
        </div>

        <!-- Add Candidate Form -->
        <div class="admin-header">
          <h3 style="font-size: 1.4rem; margin: 0;">
            <i data-lucide="user-plus" style="width: 24px; height: 24px; vertical-align: middle;"></i>
            Add New Candidate
          </h3>
        </div>
        <form id="addCandidateForm" class="flex items-center gap-4 mb-6">
          <input class="form-input" type="text" id="candidateName" placeholder="Candidate Name" required style="flex: 1;" />
          <input class="form-input" type="text" id="candidateParty" placeholder="Party (optional)" style="flex: 1;" />
          <button class="btn-primary" type="submit">
            <i data-lucide="plus-circle" style="width: 18px; height: 18px;"></i>
            Add
          </button>
        </form>
        
        <!-- Search Box -->
        <div class="search-box">
          <i data-lucide="search" class="search-icon" style="width: 20px; height: 20px;"></i>
          <input class="form-input" type="text" id="searchInput" placeholder="Search candidates..." />
        </div>

        <!-- Candidates List -->
        <div style="margin-bottom: 1.5rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="font-size: 1.4rem; margin: 0;">
              <i data-lucide="list" style="width: 24px; height: 24px; vertical-align: middle;"></i>
              Manage Candidates
            </h3>
            <button class="btn-secondary" id="refreshBtn" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
              <i data-lucide="refresh-cw" style="width: 16px; height: 16px;"></i>
              Refresh
            </button>
          </div>
          <div class="candidate-grid" id="adminCandidateList"></div>
        </div>
        
        <div class="mt-6 text-center">
          <button class="btn-secondary" id="logoutBtn">
            <i data-lucide="log-out" style="width: 18px; height: 18px;"></i>
            Logout
          </button>
          <a href="index.html" class="btn-primary ml-4">
            <i data-lucide="arrow-left" style="width: 18px; height: 18px;"></i>
            Back to Vote
          </a>
        </div>
      </div>
      
      <div id="notification" class="mt-4"></div>
    </div>
  </main>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h3 style="margin-bottom: 1.5rem; font-size: 1.5rem;">
        <i data-lucide="edit" style="width: 24px; height: 24px; vertical-align: middle;"></i>
        Edit Candidate
      </h3>
      <input class="form-input" type="text" id="editCandidateName" placeholder="Candidate Name" style="margin-bottom: 1rem;" />
      <input class="form-input" type="text" id="editCandidateParty" placeholder="Party" />
      <div class="modal-buttons">
        <button class="btn-secondary" id="cancelEdit">Cancel</button>
        <button class="btn-primary" id="saveEdit">
          <i data-lucide="save" style="width: 16px; height: 16px;"></i>
          Save Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <h3 style="margin-bottom: 1rem; font-size: 1.5rem; color: #ef4444;">
        <i data-lucide="alert-triangle" style="width: 24px; height: 24px; vertical-align: middle;"></i>
        Confirm Deletion
      </h3>
      <p style="color: #9aa4b2; margin-bottom: 1.5rem;">Are you sure you want to delete this candidate? This action cannot be undone.</p>
      <div class="modal-buttons">
        <button class="btn-secondary" id="cancelDelete">Cancel</button>
        <button class="btn-delete" id="confirmDelete">
          <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
          Delete
        </button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:4000';
    let authToken = null;
    let allCandidates = [];
    let currentEditingId = null;
    let currentDeletingId = null;

    // DOM elements
    const loginSection = document.getElementById('loginSection');
    const adminSection = document.getElementById('adminSection');
    const loginForm = document.getElementById('adminLoginForm');
    const addCandidateForm = document.getElementById('addCandidateForm');
    const candidateList = document.getElementById('adminCandidateList');
    const notification = document.getElementById('notification');
    const logoutBtn = document.getElementById('logoutBtn');
    const searchInput = document.getElementById('searchInput');
    const refreshBtn = document.getElementById('refreshBtn');
    const editModal = document.getElementById('editModal');
    const deleteModal = document.getElementById('deleteModal');

    // Initialize Lucide icons
    function initIcons() {
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }

    // Check if already logged in
    function checkAuth() {
      const token = localStorage.getItem('adminToken');
      if (token) {
        authToken = token;
        showAdminPanel();
        loadCandidates();
        updateStatistics();
      }
    }

    // Show notification
    function showNotification(message, type = 'info') {
      notification.innerHTML = `
        <div class="notification ${type}" style="display: flex; align-items: center; gap: 0.75rem; animation: slideIn 0.3s ease;">
          <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info'}" style="width: 20px; height: 20px;"></i>
          <span>${message}</span>
        </div>
      `;
      initIcons();
      setTimeout(() => {
        notification.innerHTML = '';
      }, 4000);
    }

    // Update Statistics Dashboard
    function updateStatistics() {
      // Get data from localStorage or API
      const candidates = allCandidates;
      const votes = JSON.parse(localStorage.getItem('LS_VOTES') || '[]');
      const users = JSON.parse(localStorage.getItem('LS_USERS') || '[]');
      
      document.getElementById('totalCandidates').textContent = candidates.length;
      document.getElementById('totalVotes').textContent = votes.length;
      document.getElementById('activeUsers').textContent = users.filter(u => u.hasVoted).length;
    }

    // Login as admin (localStorage-based)
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;

      // Simple admin authentication (username: admin, password: admin123)
      if ((username === 'admin' || username === 'admin@example.com') && password === 'admin123') {
        authToken = 'admin-token-' + Date.now();
        localStorage.setItem('adminToken', authToken);
        showAdminPanel();
        loadCandidates();
        updateStatistics();
        showNotification('üéâ Logged in successfully!', 'success');
      } else {
        showNotification('‚ùå Invalid credentials. Use: admin / admin123', 'error');
      }
    });

    // Show admin panel
    function showAdminPanel() {
      loginSection.style.display = 'none';
      adminSection.style.display = 'block';
      initIcons();
    }

    // Load candidates from localStorage
    function loadCandidates() {
      const candidates = JSON.parse(localStorage.getItem('LS_CANDIDATES') || '[]');
      allCandidates = candidates;
      displayCandidates(candidates);
      updateStatistics();
    }

    // Display candidates
    function displayCandidates(candidates) {
      candidateList.innerHTML = '';
      
      if (candidates.length === 0) {
        candidateList.innerHTML = '<p style="text-align: center; color: #9aa4b2; padding: 2rem;">No candidates found. Add one to get started!</p>';
        return;
      }

      candidates.forEach(candidate => {
        const card = document.createElement('div');
        card.className = 'candidate-card candidate-card-enhanced';
        card.innerHTML = `
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
            <div class='candidate-avatar'>${candidate.name[0]}</div>
            <div style="flex: 1;">
              <div class='candidate-name'>${candidate.name}</div>
              <div class='candidate-party'>${candidate.party || 'Independent'}</div>
            </div>
          </div>
          <div class="action-buttons">
            <button class="btn-small btn-edit" onclick="openEditModal('${candidate.id}')">
              <i data-lucide="edit-2" style="width: 14px; height: 14px;"></i>
              Edit
            </button>
            <button class="btn-small btn-delete" onclick="openDeleteModal('${candidate.id}')">
              <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
              Delete
            </button>
          </div>
        `;
        candidateList.appendChild(card);
      });
      
      initIcons();
    }

    // Search functionality
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      const filtered = allCandidates.filter(c => 
        c.name.toLowerCase().includes(searchTerm) || 
        (c.party && c.party.toLowerCase().includes(searchTerm))
      );
      displayCandidates(filtered);
    });

    // Refresh button
    refreshBtn.addEventListener('click', () => {
      loadCandidates();
      showNotification('Candidates list refreshed', 'success');
    });

    // Add candidate (localStorage-based)
    addCandidateForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('candidateName').value.trim();
      const party = document.getElementById('candidateParty').value.trim();

      if (!name) {
        showNotification('‚ùå Candidate name is required', 'error');
        return;
      }

      // Get existing candidates
      const candidates = JSON.parse(localStorage.getItem('LS_CANDIDATES') || '[]');
      
      // Create new candidate
      const newCandidate = {
        id: Date.now().toString(),
        name: name,
        party: party || 'Independent'
      };
      
      // Add to candidates array
      candidates.push(newCandidate);
      localStorage.setItem('LS_CANDIDATES', JSON.stringify(candidates));
      
      showNotification('‚úÖ Candidate added successfully!', 'success');
      addCandidateForm.reset();
      loadCandidates();
    });

    // Edit Modal Functions
    window.openEditModal = function(candidateId) {
      const candidate = allCandidates.find(c => c.id === candidateId);
      if (candidate) {
        currentEditingId = candidateId;
        document.getElementById('editCandidateName').value = candidate.name;
        document.getElementById('editCandidateParty').value = candidate.party || '';
        editModal.classList.add('show');
        initIcons();
      }
    };

    document.getElementById('cancelEdit').addEventListener('click', () => {
      editModal.classList.remove('show');
      currentEditingId = null;
    });

    document.getElementById('saveEdit').addEventListener('click', () => {
      const name = document.getElementById('editCandidateName').value.trim();
      const party = document.getElementById('editCandidateParty').value.trim();

      if (!name) {
        showNotification('‚ùå Candidate name is required', 'error');
        return;
      }

      // Get candidates from localStorage
      const candidates = JSON.parse(localStorage.getItem('LS_CANDIDATES') || '[]');
      
      // Find and update the candidate
      const index = candidates.findIndex(c => c.id === currentEditingId);
      if (index !== -1) {
        candidates[index] = {
          ...candidates[index],
          name: name,
          party: party || 'Independent'
        };
        
        // Save back to localStorage
        localStorage.setItem('LS_CANDIDATES', JSON.stringify(candidates));
        
        showNotification('‚úÖ Candidate updated successfully!', 'success');
        editModal.classList.remove('show');
        currentEditingId = null;
        loadCandidates();
      } else {
        showNotification('‚ùå Candidate not found', 'error');
      }
    });

    // Delete Modal Functions
    window.openDeleteModal = function(candidateId) {
      currentDeletingId = candidateId;
      deleteModal.classList.add('show');
      initIcons();
    };

    document.getElementById('cancelDelete').addEventListener('click', () => {
      deleteModal.classList.remove('show');
      currentDeletingId = null;
    });

    document.getElementById('confirmDelete').addEventListener('click', () => {
      // Get candidates from localStorage
      const candidates = JSON.parse(localStorage.getItem('LS_CANDIDATES') || '[]');
      
      // Filter out the candidate to delete
      const updatedCandidates = candidates.filter(c => c.id !== currentDeletingId);
      
      // Save back to localStorage
      localStorage.setItem('LS_CANDIDATES', JSON.stringify(updatedCandidates));
      
      showNotification('üóëÔ∏è Candidate deleted successfully', 'success');
      deleteModal.classList.remove('show');
      currentDeletingId = null;
      loadCandidates();
    });

    // Close modals on outside click
    editModal.addEventListener('click', (e) => {
      if (e.target === editModal) {
        editModal.classList.remove('show');
        currentEditingId = null;
      }
    });

    deleteModal.addEventListener('click', (e) => {
      if (e.target === deleteModal) {
        deleteModal.classList.remove('show');
        currentDeletingId = null;
      }
    });

    // Logout
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('adminToken');
      authToken = null;
      loginSection.style.display = 'block';
      adminSection.style.display = 'none';
      allCandidates = [];
      showNotification('üëã Logged out successfully', 'info');
    });

    // Initialize
    checkAuth();
    initIcons();
    
    // Auto-refresh statistics every 10 seconds
    setInterval(() => {
      if (authToken) {
        updateStatistics();
      }
    }, 10000);
  </script>
</body>
</html>